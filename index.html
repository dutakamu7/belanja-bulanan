<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Belanja Bulanan - Anak Rantau &amp; Mahasiswa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0d9488 0%, #0284c7 50%, #0d9488 100%);
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .sidebar-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover {
      transition: all 0.2s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0d9488, #0284c7);
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(13, 148, 136, 0.4);
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #10b981, #0d9488, #0284c7);
      background-size: 200% 100%;
      animation: progressGradient 2s ease infinite;
    }
    
    @keyframes progressGradient {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .checkbox-custom:checked {
      background: linear-gradient(135deg, #0d9488, #0284c7);
    }
    
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #0d9488;
      border-radius: 3px;
    }
    
    .toast {
      animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-slate-50 text-slate-800">
  <div id="app" class="h-full overflow-auto"><!-- Login Modal -->
   <div id="loginModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 fade-in">
     <div class="text-center mb-8">
      <div class="w-20 h-20 mx-auto mb-4 gradient-bg rounded-2xl flex items-center justify-center">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
       </svg>
      </div>
      <h2 class="text-2xl font-bold text-slate-800">Login Admin</h2>
      <p class="text-slate-500 mt-2">Masuk untuk mengelola data</p>
     </div>
     <form id="loginForm" class="space-y-4">
      <div><label class="block text-sm font-medium text-slate-700 mb-2">Nama Admin</label> <input type="text" id="adminName" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition" placeholder="Masukkan nama">
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-2">NIP</label> <input type="text" id="adminNip" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition" placeholder="Masukkan NIP">
      </div><button type="submit" class="w-full btn-primary text-white font-semibold py-3 rounded-xl"> Masuk </button> <button type="button" id="closeLogin" class="w-full text-slate-500 font-medium py-2 hover:text-slate-700 transition"> Kembali </button>
     </form>
     <p id="loginError" class="text-red-500 text-sm text-center mt-4 hidden">Nama atau NIP salah!</p>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed top-4 right-4 z-50 hidden">
    <div class="bg-teal-600 text-white px-6 py-3 rounded-xl shadow-lg toast flex items-center gap-3">
     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
     </svg><span id="toastMessage">Berhasil!</span>
    </div>
   </div><!-- ========== USER VIEW ========== -->
   <div id="userView" class="min-h-full"><!-- Header -->
    <header class="gradient-bg text-white sticky top-0 z-40">
     <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
       <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
         </svg>
        </div>
        <div>
         <h1 id="siteTitle" class="text-xl font-bold">Belanja Bulanan</h1>
         <p id="siteTagline" class="text-xs text-white/80">Kelola keuangan dengan cerdas</p>
        </div>
       </div><button id="adminLoginBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl text-sm font-medium backdrop-blur transition flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg><span class="hidden sm:inline">Admin</span> </button>
      </div><!-- User Navigation -->
      <nav class="mt-4 flex gap-2 overflow-x-auto pb-2"><button class="user-nav-btn active px-4 py-2 bg-white/20 rounded-xl text-sm font-medium whitespace-nowrap transition hover:bg-white/30" data-tab="beranda">ğŸ  Beranda</button> <button class="user-nav-btn px-4 py-2 bg-white/10 rounded-xl text-sm font-medium whitespace-nowrap transition hover:bg-white/20" data-tab="daftar">ğŸ“¦ Daftar Barang</button> <button class="user-nav-btn px-4 py-2 bg-white/10 rounded-xl text-sm font-medium whitespace-nowrap transition hover:bg-white/20" data-tab="belanja">ğŸ›’ Belanja</button> <button class="user-nav-btn px-4 py-2 bg-white/10 rounded-xl text-sm font-medium whitespace-nowrap transition hover:bg-white/20" data-tab="rekap">ğŸ“Š Rekap</button> <button class="user-nav-btn px-4 py-2 bg-white/10 rounded-xl text-sm font-medium whitespace-nowrap transition hover:bg-white/20" data-tab="tips">ğŸ’¡ Tips</button>
      </nav>
     </div>
    </header><!-- User Content -->
    <main class="max-w-7xl mx-auto px-4 py-6"><!-- Beranda Tab -->
     <div id="tab-beranda" class="user-tab-content fade-in"><!-- Stats Cards -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
       <div class="bg-white rounded-2xl p-4 shadow-sm card-hover border border-slate-100">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ“¦</span>
         </div>
         <div>
          <p class="text-xs text-slate-500">Total Barang</p>
          <p id="statTotalItems" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-4 shadow-sm card-hover border border-slate-100">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-sky-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ›’</span>
         </div>
         <div>
          <p class="text-xs text-slate-500">Di Keranjang</p>
          <p id="statCartItems" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-4 shadow-sm card-hover border border-slate-100">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center"><span class="text-2xl">âœ…</span>
         </div>
         <div>
          <p class="text-xs text-slate-500">Sudah Beli</p>
          <p id="statCheckedItems" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-4 shadow-sm card-hover border border-slate-100">
        <div class="flex items-center gap-3">
         <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ’°</span>
         </div>
         <div>
          <p class="text-xs text-slate-500">Total Belanja</p>
          <p id="statTotalSpent" class="text-lg font-bold text-slate-800">Rp 0</p>
         </div>
        </div>
       </div>
      </div><!-- Budget Progress -->
      <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-100">
       <div class="flex items-center justify-between mb-4">
        <h3 class="font-semibold text-slate-800">ğŸ’µ Anggaran Bulanan</h3>
        <div class="flex items-center gap-2"><span class="text-sm text-slate-500">Rp</span> <input type="number" id="budgetInput" class="w-32 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 outline-none" placeholder="1000000" value="1000000">
        </div>
       </div>
       <div class="h-4 bg-slate-100 rounded-full overflow-hidden mb-2">
        <div id="budgetProgress" class="h-full progress-bar rounded-full transition-all duration-500" style="width: 0%"></div>
       </div>
       <div class="flex justify-between text-sm"><span class="text-slate-500">Terpakai: <span id="budgetUsed" class="font-semibold text-slate-700">Rp 0</span></span> <span class="text-slate-500">Sisa: <span id="budgetRemaining" class="font-semibold text-emerald-600">Rp 1.000.000</span></span>
       </div>
      </div><!-- Quick Actions -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="switchUserTab('daftar')" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 text-center"> <span class="text-3xl mb-2 block">ğŸ“‹</span> <p class="font-medium text-slate-700">Lihat Barang</p></button> <button onclick="switchUserTab('belanja')" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 text-center"> <span class="text-3xl mb-2 block">ğŸ›’</span> <p class="font-medium text-slate-700">Mulai Belanja</p></button> <button onclick="switchUserTab('rekap')" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 text-center"> <span class="text-3xl mb-2 block">ğŸ“Š</span> <p class="font-medium text-slate-700">Lihat Rekap</p></button> <button onclick="switchUserTab('tips')" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 text-center"> <span class="text-3xl mb-2 block">ğŸ’¡</span> <p class="font-medium text-slate-700">Tips Hemat</p></button>
      </div>
     </div><!-- Daftar Barang Tab -->
     <div id="tab-daftar" class="user-tab-content hidden fade-in">
      <div class="flex flex-col sm:flex-row gap-4 mb-6">
       <div class="flex-1 relative">
        <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg><input type="text" id="searchItems" class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 outline-none" placeholder="Cari barang...">
       </div><select id="filterCategory" class="px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 outline-none bg-white"> <option value="">Semua Kategori</option> <option value="Sembako">ğŸš Sembako</option> <option value="Makanan Instan">ğŸœ Makanan Instan</option> <option value="Minuman">ğŸ¥¤ Minuman</option> <option value="Alat Mandi">ğŸ§´ Alat Mandi</option> <option value="Alat Kebersihan">ğŸ§¹ Alat Kebersihan</option> <option value="Alat Sekolah">ğŸ“š Alat Sekolah</option> <option value="Kebutuhan Kost">ğŸ  Kebutuhan Kost</option> <option value="Lainnya">ğŸ“¦ Lainnya</option> </select>
      </div>
      <div id="itemsList" class="grid gap-3">
       <div class="text-center py-12 text-slate-400"><span class="text-4xl mb-4 block">ğŸ“¦</span>
        <p>Belum ada barang tersedia</p>
        <p class="text-sm">Admin perlu menambahkan data barang</p>
       </div>
      </div>
     </div><!-- Belanja Tab -->
     <div id="tab-belanja" class="user-tab-content hidden fade-in">
      <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-100">
       <h3 class="font-semibold text-slate-800 mb-4">ğŸ›’ Keranjang Belanja</h3>
       <div id="cartList" class="space-y-3 max-h-96 overflow-y-auto">
        <div class="text-center py-8 text-slate-400"><span class="text-4xl mb-2 block">ğŸ›’</span>
         <p>Keranjang kosong</p>
         <p class="text-sm">Tambahkan barang dari daftar</p>
        </div>
       </div>
      </div>
      <div class="bg-gradient-to-r from-teal-600 to-sky-600 rounded-2xl p-6 text-white">
       <div class="flex justify-between items-center mb-4"><span class="font-medium">Total Belanja</span> <span id="cartTotal" class="text-2xl font-bold">Rp 0</span>
       </div>
       <div class="flex gap-3"><button id="clearCartBtn" class="flex-1 bg-white/20 hover:bg-white/30 py-3 rounded-xl font-medium transition"> ğŸ—‘ï¸ Kosongkan </button> <button id="checkoutBtn" class="flex-1 bg-white text-teal-600 hover:bg-white/90 py-3 rounded-xl font-semibold transition"> âœ… Selesai Belanja </button>
       </div>
      </div>
     </div><!-- Rekap Tab -->
     <div id="tab-rekap" class="user-tab-content hidden fade-in">
      <div class="bg-white rounded-2xl p-6 shadow-sm mb-6 border border-slate-100">
       <h3 class="font-semibold text-slate-800 mb-4">ğŸ“Š Rekap Belanja Bulanan</h3><!-- Category Summary -->
       <div id="categorySummary" class="space-y-3 mb-6">
        <div class="text-center py-8 text-slate-400">
         <p>Belum ada data belanja</p>
        </div>
       </div>
       <div class="border-t border-slate-100 pt-4">
        <div class="flex justify-between items-center text-lg"><span class="font-semibold text-slate-700">Total Pengeluaran</span> <span id="rekapTotal" class="font-bold text-teal-600">Rp 0</span>
        </div>
       </div>
      </div>
      <div class="grid sm:grid-cols-2 gap-4"><button id="downloadPdfBtn" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 flex items-center gap-4">
        <div class="w-14 h-14 bg-red-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ“„</span>
        </div>
        <div class="text-left">
         <p class="font-semibold text-slate-800">Download PDF</p>
         <p class="text-sm text-slate-500">Simpan rekap belanja</p>
        </div></button> <button id="shareWaBtn" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 flex items-center gap-4">
        <div class="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ’¬</span>
        </div>
        <div class="text-left">
         <p class="font-semibold text-slate-800">Kirim WhatsApp</p>
         <p class="text-sm text-slate-500">Bagikan rekap</p>
        </div></button>
      </div>
     </div><!-- Tips Tab -->
     <div id="tab-tips" class="user-tab-content hidden fade-in">
      <div class="space-y-4">
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ“</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Buat Daftar Sebelum Belanja</h4>
          <p class="text-slate-600 text-sm">Selalu buat daftar kebutuhan sebelum pergi belanja untuk menghindari pembelian impulsif.</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ·ï¸</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Bandingkan Harga</h4>
          <p class="text-slate-600 text-sm">Cek harga di beberapa toko sebelum membeli. Manfaatkan promo dan diskon.</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ“¦</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Beli dalam Kemasan Besar</h4>
          <p class="text-slate-600 text-sm">Untuk barang yang sering dipakai, beli kemasan besar lebih hemat per unitnya.</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ³</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Masak Sendiri</h4>
          <p class="text-slate-600 text-sm">Memasak sendiri lebih hemat daripada beli makanan jadi. Belajar resep sederhana!</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ’°</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Sisihkan Dana Darurat</h4>
          <p class="text-slate-600 text-sm">Sisihkan 10-20% dari uang bulanan untuk keperluan tak terduga.</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100">
        <div class="flex items-start gap-4"><span class="text-3xl">ğŸ“…</span>
         <div>
          <h4 class="font-semibold text-slate-800 mb-2">Belanja di Awal Bulan</h4>
          <p class="text-slate-600 text-sm">Belanja kebutuhan pokok di awal bulan saat uang masih cukup.</p>
         </div>
        </div>
       </div>
      </div>
     </div>
    </main>
   </div><!-- ========== ADMIN VIEW ========== -->
   <div id="adminView" class="min-h-full hidden">
    <div class="flex h-full"><!-- Sidebar -->
     <aside id="adminSidebar" class="w-64 bg-slate-800 text-white sidebar-transition fixed h-full z-30 lg:relative">
      <div class="p-4 border-b border-slate-700">
       <div class="flex items-center gap-3">
        <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
         </svg>
        </div>
        <div id="sidebarTitle" class="overflow-hidden">
         <h2 class="font-bold text-sm">Admin Panel</h2>
         <p class="text-xs text-slate-400">Duta Hilmy Pratama</p>
        </div>
       </div>
      </div>
      <nav class="p-4 space-y-2" id="sidebarNav"><button class="admin-nav-btn active w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-white/10 text-left transition hover:bg-white/20" data-tab="dashboard"> <span>ğŸ“Š</span> <span class="nav-text">Dashboard</span> </button> <button class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-white/10" data-tab="dataBarang"> <span>ğŸ“¦</span> <span class="nav-text">Data Barang</span> </button> <button class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-white/10" data-tab="kategori"> <span>ğŸ·ï¸</span> <span class="nav-text">Kategori</span> </button> <button class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-white/10" data-tab="paket"> <span>ğŸ“‹</span> <span class="nav-text">Paket Belanja</span> </button> <button class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-white/10" data-tab="laporan"> <span>ğŸ“ˆ</span> <span class="nav-text">Laporan</span> </button>
      </nav>
      <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-slate-700"><button id="logoutBtn" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-red-500/20 text-red-300 hover:bg-red-500/30 transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg><span class="nav-text">Logout</span> </button>
      </div>
     </aside><!-- Sidebar Overlay -->
     <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-20 lg:hidden hidden"></div><!-- Main Content -->
     <div class="flex-1 lg:ml-0"><!-- Top Bar -->
      <header class="bg-white shadow-sm sticky top-0 z-10 px-4 py-3 flex items-center justify-between"><button id="toggleSidebar" class="lg:hidden p-2 rounded-lg hover:bg-slate-100">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg></button>
       <h1 id="adminPageTitle" class="text-lg font-semibold text-slate-800">Dashboard</h1>
       <div class="flex items-center gap-2"><span class="text-sm text-slate-500 hidden sm:inline">NIP: 101032530012</span>
       </div>
      </header><!-- Admin Content -->
      <main class="p-4 lg:p-6"><!-- Dashboard Tab -->
       <div id="admin-dashboard" class="admin-tab-content fade-in">
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
         <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
          <div class="flex items-center justify-between">
           <div>
            <p class="text-sm text-slate-500">Total Barang</p>
            <p id="adminStatItems" class="text-2xl font-bold text-slate-800">0</p>
           </div>
           <div class="w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center"><span class="text-xl">ğŸ“¦</span>
           </div>
          </div>
         </div>
         <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
          <div class="flex items-center justify-between">
           <div>
            <p class="text-sm text-slate-500">Kategori</p>
            <p class="text-2xl font-bold text-slate-800">8</p>
           </div>
           <div class="w-12 h-12 bg-sky-100 rounded-xl flex items-center justify-center"><span class="text-xl">ğŸ·ï¸</span>
           </div>
          </div>
         </div>
         <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
          <div class="flex items-center justify-between">
           <div>
            <p class="text-sm text-slate-500">Paket</p>
            <p id="adminStatPackages" class="text-2xl font-bold text-slate-800">0</p>
           </div>
           <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center"><span class="text-xl">ğŸ“‹</span>
           </div>
          </div>
         </div>
         <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
          <div class="flex items-center justify-between">
           <div>
            <p class="text-sm text-slate-500">Di Keranjang</p>
            <p id="adminStatCart" class="text-2xl font-bold text-slate-800">0</p>
           </div>
           <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center"><span class="text-xl">ğŸ›’</span>
           </div>
          </div>
         </div>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
         <h3 class="font-semibold text-slate-800 mb-4">ğŸš€ Aksi Cepat</h3>
         <div class="grid sm:grid-cols-3 gap-4"><button onclick="switchAdminTab('dataBarang')" class="p-4 border-2 border-dashed border-slate-200 rounded-xl hover:border-teal-400 hover:bg-teal-50 transition text-center"> <span class="text-2xl mb-2 block">â•</span> <p class="font-medium text-slate-700">Tambah Barang</p></button> <button onclick="switchAdminTab('paket')" class="p-4 border-2 border-dashed border-slate-200 rounded-xl hover:border-teal-400 hover:bg-teal-50 transition text-center"> <span class="text-2xl mb-2 block">ğŸ“‹</span> <p class="font-medium text-slate-700">Buat Paket</p></button> <button onclick="switchAdminTab('laporan')" class="p-4 border-2 border-dashed border-slate-200 rounded-xl hover:border-teal-400 hover:bg-teal-50 transition text-center"> <span class="text-2xl mb-2 block">ğŸ“Š</span> <p class="font-medium text-slate-700">Lihat Laporan</p></button>
         </div>
        </div>
       </div><!-- Data Barang Tab -->
       <div id="admin-dataBarang" class="admin-tab-content hidden fade-in">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 mb-6">
         <h3 class="font-semibold text-slate-800 mb-4">â• Tambah Barang Baru</h3>
         <form id="addItemForm" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div><label class="block text-sm font-medium text-slate-700 mb-1">Nama Barang</label> <input type="text" id="itemName" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="Beras" required>
          </div>
          <div><label class="block text-sm font-medium text-slate-700 mb-1">Harga (Rp)</label> <input type="number" id="itemPrice" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="15000" required>
          </div>
          <div><label class="block text-sm font-medium text-slate-700 mb-1">Kategori</label> <select id="itemCategory" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-white" required> <option value="">Pilih Kategori</option> <option value="Sembako">Sembako</option> <option value="Makanan Instan">Makanan Instan</option> <option value="Minuman">Minuman</option> <option value="Alat Mandi">Alat Mandi</option> <option value="Alat Kebersihan">Alat Kebersihan</option> <option value="Alat Sekolah">Alat Sekolah</option> <option value="Kebutuhan Kost">Kebutuhan Kost</option> <option value="Lainnya">Lainnya</option> </select>
          </div>
          <div><label class="block text-sm font-medium text-slate-700 mb-1">Satuan</label> <select id="itemUnit" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none bg-white"> <option value="pcs">Pcs</option> <option value="kg">Kg</option> <option value="liter">Liter</option> <option value="pack">Pack</option> <option value="dus">Dus</option> <option value="botol">Botol</option> </select>
          </div>
          <div class="sm:col-span-2 lg:col-span-4"><button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg font-medium"> ğŸ’¾ Simpan Barang </button>
          </div>
         </form>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
         <h3 class="font-semibold text-slate-800 mb-4">ğŸ“¦ Daftar Barang</h3>
         <div id="adminItemsList" class="overflow-x-auto">
          <table class="w-full text-sm">
           <thead>
            <tr class="border-b border-slate-100">
             <th class="text-left py-3 px-4 font-semibold text-slate-600">Nama</th>
             <th class="text-left py-3 px-4 font-semibold text-slate-600">Harga</th>
             <th class="text-left py-3 px-4 font-semibold text-slate-600">Kategori</th>
             <th class="text-left py-3 px-4 font-semibold text-slate-600">Satuan</th>
             <th class="text-center py-3 px-4 font-semibold text-slate-600">Aksi</th>
            </tr>
           </thead>
           <tbody id="adminItemsTable">
            <tr>
             <td colspan="5" class="text-center py-8 text-slate-400">Belum ada barang</td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
       </div><!-- Kategori Tab -->
       <div id="admin-kategori" class="admin-tab-content hidden fade-in">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
         <h3 class="font-semibold text-slate-800 mb-4">ğŸ·ï¸ Kategori Barang</h3>
         <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="p-4 bg-amber-50 rounded-xl border border-amber-200"><span class="text-2xl">ğŸš</span>
           <h4 class="font-semibold text-slate-800 mt-2">Sembako</h4>
           <p class="text-sm text-slate-500">Beras, minyak, gula, dll</p>
          </div>
          <div class="p-4 bg-orange-50 rounded-xl border border-orange-200"><span class="text-2xl">ğŸœ</span>
           <h4 class="font-semibold text-slate-800 mt-2">Makanan Instan</h4>
           <p class="text-sm text-slate-500">Mie, snack, dll</p>
          </div>
          <div class="p-4 bg-cyan-50 rounded-xl border border-cyan-200"><span class="text-2xl">ğŸ¥¤</span>
           <h4 class="font-semibold text-slate-800 mt-2">Minuman</h4>
           <p class="text-sm text-slate-500">Air, kopi, teh, dll</p>
          </div>
          <div class="p-4 bg-pink-50 rounded-xl border border-pink-200"><span class="text-2xl">ğŸ§´</span>
           <h4 class="font-semibold text-slate-800 mt-2">Alat Mandi</h4>
           <p class="text-sm text-slate-500">Sabun, shampoo, dll</p>
          </div>
          <div class="p-4 bg-emerald-50 rounded-xl border border-emerald-200"><span class="text-2xl">ğŸ§¹</span>
           <h4 class="font-semibold text-slate-800 mt-2">Alat Kebersihan</h4>
           <p class="text-sm text-slate-500">Sapu, pel, detergen</p>
          </div>
          <div class="p-4 bg-blue-50 rounded-xl border border-blue-200"><span class="text-2xl">ğŸ“š</span>
           <h4 class="font-semibold text-slate-800 mt-2">Alat Sekolah</h4>
           <p class="text-sm text-slate-500">Buku, pulpen, dll</p>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200"><span class="text-2xl">ğŸ </span>
           <h4 class="font-semibold text-slate-800 mt-2">Kebutuhan Kost</h4>
           <p class="text-sm text-slate-500">Ember, gantungan, dll</p>
          </div>
          <div class="p-4 bg-slate-50 rounded-xl border border-slate-200"><span class="text-2xl">ğŸ“¦</span>
           <h4 class="font-semibold text-slate-800 mt-2">Lainnya</h4>
           <p class="text-sm text-slate-500">Kebutuhan lain-lain</p>
          </div>
         </div>
        </div>
       </div><!-- Paket Tab -->
       <div id="admin-paket" class="admin-tab-content hidden fade-in">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 mb-6">
         <h3 class="font-semibold text-slate-800 mb-4">ğŸ“‹ Buat Paket Belanja</h3>
         <form id="createPackageForm" class="space-y-4">
          <div class="grid sm:grid-cols-2 gap-4">
           <div><label class="block text-sm font-medium text-slate-700 mb-1">Nama Paket</label> <input type="text" id="packageName" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="Paket Hemat Mahasiswa" required>
           </div>
           <div><label class="block text-sm font-medium text-slate-700 mb-1">Budget (Rp)</label> <input type="number" id="packageBudget" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" placeholder="500000" required>
           </div>
          </div><button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg font-medium"> âœ¨ Buat Paket </button>
         </form>
        </div>
        <div id="packagesList" class="grid sm:grid-cols-2 gap-4">
         <div class="text-center py-12 text-slate-400 col-span-2"><span class="text-4xl mb-4 block">ğŸ“‹</span>
          <p>Belum ada paket dibuat</p>
         </div>
        </div>
       </div><!-- Laporan Tab -->
       <div id="admin-laporan" class="admin-tab-content hidden fade-in">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 mb-6">
         <h3 class="font-semibold text-slate-800 mb-4">ğŸ“ˆ Ringkasan Data</h3>
         <div id="reportSummary" class="space-y-4">
          <div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600">Total Barang Terdaftar</span> <span id="reportTotalItems" class="font-semibold text-slate-800">0</span>
          </div>
          <div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600">Barang di Keranjang</span> <span id="reportCartItems" class="font-semibold text-slate-800">0</span>
          </div>
          <div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600">Total Nilai Keranjang</span> <span id="reportCartValue" class="font-semibold text-teal-600">Rp 0</span>
          </div>
          <div class="flex justify-between items-center py-3"><span class="text-slate-600">Paket Belanja Dibuat</span> <span id="reportPackages" class="font-semibold text-slate-800">0</span>
          </div>
         </div>
        </div>
        <div class="grid sm:grid-cols-2 gap-4"><button id="exportExcelBtn" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 flex items-center gap-4">
          <div class="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ“Š</span>
          </div>
          <div class="text-left">
           <p class="font-semibold text-slate-800">Export Excel</p>
           <p class="text-sm text-slate-500">Download data CSV</p>
          </div></button> <button id="exportPdfAdminBtn" class="bg-white rounded-2xl p-6 shadow-sm card-hover border border-slate-100 flex items-center gap-4">
          <div class="w-14 h-14 bg-red-100 rounded-xl flex items-center justify-center"><span class="text-2xl">ğŸ“„</span>
          </div>
          <div class="text-left">
           <p class="font-semibold text-slate-800">Export PDF</p>
           <p class="text-sm text-slate-500">Download laporan PDF</p>
          </div></button>
        </div>
       </div>
      </main>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ========== STATE MANAGEMENT ==========
    let allData = [];
    let items = [];
    let cartItems = [];
    let packages = [];
    let isAdmin = false;
    let currentUserTab = 'beranda';
    let currentAdminTab = 'dashboard';
    
    const defaultConfig = {
      site_title: 'Belanja Bulanan',
      tagline: 'Kelola keuangan dengan cerdas'
    };
    
    const categoryEmoji = {
      'Sembako': 'ğŸš',
      'Makanan Instan': 'ğŸœ',
      'Minuman': 'ğŸ¥¤',
      'Alat Mandi': 'ğŸ§´',
      'Alat Kebersihan': 'ğŸ§¹',
      'Alat Sekolah': 'ğŸ“š',
      'Kebutuhan Kost': 'ğŸ ',
      'Lainnya': 'ğŸ“¦'
    };

    // ========== DATA SDK ==========
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        items = data.filter(d => d.type === 'item');
        cartItems = data.filter(d => d.type === 'cart');
        packages = data.filter(d => d.type === 'package');
        
        renderAll();
      }
    };

    async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to init data SDK');
        }
      }
    }

    // ========== ELEMENT SDK ==========
    function initElementSdk() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById('siteTitle').textContent = config.site_title || defaultConfig.site_title;
            document.getElementById('siteTagline').textContent = config.tagline || defaultConfig.tagline;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['site_title', config.site_title || defaultConfig.site_title],
            ['tagline', config.tagline || defaultConfig.tagline]
          ])
        });
      }
    }

    // ========== RENDER FUNCTIONS ==========
    function renderAll() {
      renderUserStats();
      renderItemsList();
      renderCartList();
      renderCategorySummary();
      renderAdminStats();
      renderAdminItemsTable();
      renderPackagesList();
      renderReports();
    }

    function renderUserStats() {
      const totalItems = items.length;
      const cartCount = cartItems.length;
      const checkedCount = cartItems.filter(c => c.checked).length;
      const totalSpent = cartItems.reduce((sum, c) => {
        const item = items.find(i => i.name === c.name);
        return sum + (item ? item.price * c.quantity : 0);
      }, 0);
      
      document.getElementById('statTotalItems').textContent = totalItems;
      document.getElementById('statCartItems').textContent = cartCount;
      document.getElementById('statCheckedItems').textContent = checkedCount;
      document.getElementById('statTotalSpent').textContent = formatCurrency(totalSpent);
      
      const budget = parseInt(document.getElementById('budgetInput').value) || 1000000;
      const percentage = Math.min((totalSpent / budget) * 100, 100);
      document.getElementById('budgetProgress').style.width = percentage + '%';
      document.getElementById('budgetUsed').textContent = formatCurrency(totalSpent);
      document.getElementById('budgetRemaining').textContent = formatCurrency(Math.max(budget - totalSpent, 0));
      
      if (percentage > 80) {
        document.getElementById('budgetRemaining').className = 'font-semibold text-red-500';
      } else {
        document.getElementById('budgetRemaining').className = 'font-semibold text-emerald-600';
      }
    }

    function renderItemsList() {
      const container = document.getElementById('itemsList');
      const searchTerm = document.getElementById('searchItems').value.toLowerCase();
      const categoryFilter = document.getElementById('filterCategory').value;
      
      let filtered = items.filter(item => {
        const matchSearch = item.name.toLowerCase().includes(searchTerm);
        const matchCategory = !categoryFilter || item.category === categoryFilter;
        return matchSearch && matchCategory;
      });
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="text-center py-12 text-slate-400">
            <span class="text-4xl mb-4 block">ğŸ“¦</span>
            <p>Tidak ada barang ditemukan</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filtered.map(item => `
        <div class="bg-white rounded-xl p-4 shadow-sm card-hover border border-slate-100 flex items-center justify-between gap-4">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center text-2xl">
              ${categoryEmoji[item.category] || 'ğŸ“¦'}
            </div>
            <div>
              <h4 class="font-semibold text-slate-800">${item.name}</h4>
              <p class="text-sm text-slate-500">${item.category} â€¢ ${item.unit}</p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <span class="font-bold text-teal-600">${formatCurrency(item.price)}</span>
            <button onclick="addToCart('${item.__backendId}')" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
              + Keranjang
            </button>
          </div>
        </div>
      `).join('');
    }

    function renderCartList() {
      const container = document.getElementById('cartList');
      
      if (cartItems.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-slate-400">
            <span class="text-4xl mb-2 block">ğŸ›’</span>
            <p>Keranjang kosong</p>
          </div>
        `;
        document.getElementById('cartTotal').textContent = 'Rp 0';
        return;
      }
      
      let total = 0;
      container.innerHTML = cartItems.map(cartItem => {
        const item = items.find(i => i.name === cartItem.name);
        const subtotal = item ? item.price * cartItem.quantity : 0;
        total += subtotal;
        
        return `
          <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl ${cartItem.checked ? 'opacity-60' : ''}">
            <div class="flex items-center gap-3">
              <input type="checkbox" ${cartItem.checked ? 'checked' : ''} onchange="toggleCartItem('${cartItem.__backendId}')" class="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500">
              <div>
                <h5 class="font-medium text-slate-800 ${cartItem.checked ? 'line-through' : ''}">${cartItem.name}</h5>
                <p class="text-sm text-slate-500">${formatCurrency(item?.price || 0)} x ${cartItem.quantity}</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="updateCartQuantity('${cartItem.__backendId}', ${cartItem.quantity - 1})" class="w-8 h-8 bg-slate-200 rounded-lg hover:bg-slate-300 transition">-</button>
              <span class="w-8 text-center font-medium">${cartItem.quantity}</span>
              <button onclick="updateCartQuantity('${cartItem.__backendId}', ${cartItem.quantity + 1})" class="w-8 h-8 bg-slate-200 rounded-lg hover:bg-slate-300 transition">+</button>
              <button onclick="removeFromCart('${cartItem.__backendId}')" class="w-8 h-8 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition ml-2">Ã—</button>
            </div>
          </div>
        `;
      }).join('');
      
      document.getElementById('cartTotal').textContent = formatCurrency(total);
    }

    function renderCategorySummary() {
      const container = document.getElementById('categorySummary');
      
      if (cartItems.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-slate-400">
            <p>Belum ada data belanja</p>
          </div>
        `;
        document.getElementById('rekapTotal').textContent = 'Rp 0';
        return;
      }
      
      const categoryTotals = {};
      let grandTotal = 0;
      
      cartItems.forEach(cartItem => {
        const item = items.find(i => i.name === cartItem.name);
        if (item) {
          const subtotal = item.price * cartItem.quantity;
          categoryTotals[item.category] = (categoryTotals[item.category] || 0) + subtotal;
          grandTotal += subtotal;
        }
      });
      
      container.innerHTML = Object.entries(categoryTotals).map(([category, total]) => `
        <div class="flex items-center justify-between py-3 border-b border-slate-100">
          <div class="flex items-center gap-3">
            <span class="text-xl">${categoryEmoji[category] || 'ğŸ“¦'}</span>
            <span class="text-slate-700">${category}</span>
          </div>
          <span class="font-semibold text-slate-800">${formatCurrency(total)}</span>
        </div>
      `).join('');
      
      document.getElementById('rekapTotal').textContent = formatCurrency(grandTotal);
    }

    function renderAdminStats() {
      document.getElementById('adminStatItems').textContent = items.length;
      document.getElementById('adminStatPackages').textContent = packages.length;
      document.getElementById('adminStatCart').textContent = cartItems.length;
    }

    function renderAdminItemsTable() {
      const tbody = document.getElementById('adminItemsTable');
      
      if (items.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="text-center py-8 text-slate-400">
              Belum ada barang
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = items.map(item => `
        <tr class="border-b border-slate-50 hover:bg-slate-50">
          <td class="py-3 px-4">${item.name}</td>
          <td class="py-3 px-4">${formatCurrency(item.price)}</td>
          <td class="py-3 px-4">
            <span class="px-2 py-1 bg-slate-100 rounded-lg text-xs">${item.category}</span>
          </td>
          <td class="py-3 px-4">${item.unit}</td>
          <td class="py-3 px-4 text-center">
            <button onclick="deleteItem('${item.__backendId}')" class="px-3 py-1 bg-red-100 text-red-600 rounded-lg text-sm hover:bg-red-200 transition">
              Hapus
            </button>
          </td>
        </tr>
      `).join('');
    }

    function renderPackagesList() {
      const container = document.getElementById('packagesList');
      
      if (packages.length === 0) {
        container.innerHTML = `
          <div class="text-center py-12 text-slate-400 col-span-2">
            <span class="text-4xl mb-4 block">ğŸ“‹</span>
            <p>Belum ada paket dibuat</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = packages.map(pkg => `
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 card-hover">
          <div class="flex items-start justify-between mb-4">
            <div>
              <h4 class="font-semibold text-slate-800">${pkg.name}</h4>
              <p class="text-sm text-slate-500">Budget: ${formatCurrency(pkg.price)}</p>
            </div>
            <button onclick="deletePackage('${pkg.__backendId}')" class="text-red-500 hover:text-red-700">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    function renderReports() {
      const cartValue = cartItems.reduce((sum, c) => {
        const item = items.find(i => i.name === c.name);
        return sum + (item ? item.price * c.quantity : 0);
      }, 0);
      
      document.getElementById('reportTotalItems').textContent = items.length;
      document.getElementById('reportCartItems').textContent = cartItems.length;
      document.getElementById('reportCartValue').textContent = formatCurrency(cartValue);
      document.getElementById('reportPackages').textContent = packages.length;
    }

    // ========== DATA ACTIONS ==========
    async function addItem(name, price, category, unit) {
      if (allData.length >= 999) {
        showToast('Batas maksimum 999 data tercapai!');
        return;
      }
      
      const result = await window.dataSdk.create({
        type: 'item',
        name,
        price: parseInt(price),
        category,
        unit,
        quantity: 0,
        checked: false,
        createdAt: new Date().toISOString()
      });
      
      if (result.isOk) {
        showToast('Barang berhasil ditambahkan!');
      }
    }

    async function deleteItem(id) {
      const item = allData.find(d => d.__backendId === id);
      if (item) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
          showToast('Barang berhasil dihapus!');
        }
      }
    }

    async function addToCart(itemId) {
      if (allData.length >= 999) {
        showToast('Batas maksimum 999 data tercapai!');
        return;
      }
      
      const item = items.find(i => i.__backendId === itemId);
      if (!item) return;
      
      const existingCart = cartItems.find(c => c.name === item.name);
      if (existingCart) {
        const result = await window.dataSdk.update({
          ...existingCart,
          quantity: existingCart.quantity + 1
        });
        if (result.isOk) {
          showToast('Jumlah ditambah!');
        }
      } else {
        const result = await window.dataSdk.create({
          type: 'cart',
          name: item.name,
          price: item.price,
          category: item.category,
          unit: item.unit,
          quantity: 1,
          checked: false,
          createdAt: new Date().toISOString()
        });
        if (result.isOk) {
          showToast('Ditambah ke keranjang!');
        }
      }
    }

    async function updateCartQuantity(id, newQuantity) {
      const cartItem = cartItems.find(c => c.__backendId === id);
      if (!cartItem) return;
      
      if (newQuantity <= 0) {
        await removeFromCart(id);
        return;
      }
      
      await window.dataSdk.update({
        ...cartItem,
        quantity: newQuantity
      });
    }

    async function toggleCartItem(id) {
      const cartItem = cartItems.find(c => c.__backendId === id);
      if (cartItem) {
        await window.dataSdk.update({
          ...cartItem,
          checked: !cartItem.checked
        });
      }
    }

    async function removeFromCart(id) {
      const cartItem = cartItems.find(c => c.__backendId === id);
      if (cartItem) {
        const result = await window.dataSdk.delete(cartItem);
        if (result.isOk) {
          showToast('Dihapus dari keranjang!');
        }
      }
    }

    async function clearCart() {
      for (const cartItem of cartItems) {
        await window.dataSdk.delete(cartItem);
      }
      showToast('Keranjang dikosongkan!');
    }

    async function createPackage(name, budget) {
      if (allData.length >= 999) {
        showToast('Batas maksimum 999 data tercapai!');
        return;
      }
      
      const result = await window.dataSdk.create({
        type: 'package',
        name,
        price: parseInt(budget),
        category: 'Paket',
        unit: 'paket',
        quantity: 1,
        checked: false,
        createdAt: new Date().toISOString()
      });
      
      if (result.isOk) {
        showToast('Paket berhasil dibuat!');
      }
    }

    async function deletePackage(id) {
      const pkg = packages.find(p => p.__backendId === id);
      if (pkg) {
        await window.dataSdk.delete(pkg);
        showToast('Paket dihapus!');
      }
    }

    // ========== EXPORT FUNCTIONS ==========
    function generatePDF() {
      const total = cartItems.reduce((sum, c) => {
        const item = items.find(i => i.name === c.name);
        return sum + (item ? item.price * c.quantity : 0);
      }, 0);
      
      let content = `
REKAP BELANJA BULANAN
=====================
Tanggal: ${new Date().toLocaleDateString('id-ID', { dateStyle: 'full' })}

DAFTAR BELANJA:
`;
      
      cartItems.forEach((c, i) => {
        const item = items.find(it => it.name === c.name);
        const subtotal = item ? item.price * c.quantity : 0;
        content += `${i + 1}. ${c.name} - ${c.quantity} x ${formatCurrency(item?.price || 0)} = ${formatCurrency(subtotal)}\n`;
      });
      
      content += `
=====================
TOTAL: ${formatCurrency(total)}
=====================

Dibuat dengan Belanja Bulanan App
      `;
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `rekap-belanja-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Rekap berhasil diunduh!');
    }

    function shareWhatsApp() {
      const total = cartItems.reduce((sum, c) => {
        const item = items.find(i => i.name === c.name);
        return sum + (item ? item.price * c.quantity : 0);
      }, 0);
      
      let message = `ğŸ“‹ *REKAP BELANJA BULANAN*\n`;
      message += `ğŸ“… ${new Date().toLocaleDateString('id-ID', { dateStyle: 'full' })}\n\n`;
      
      cartItems.forEach((c, i) => {
        const item = items.find(it => it.name === c.name);
        message += `${i + 1}. ${c.name} (${c.quantity}x) - ${formatCurrency(item?.price * c.quantity || 0)}\n`;
      });
      
      message += `\nğŸ’° *TOTAL: ${formatCurrency(total)}*\n\n`;
      message += `_Dibuat dengan Belanja Bulanan App_`;
      
      const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(url, '_blank');
    }

    function exportCSV() {
      let csv = 'Nama,Harga,Kategori,Satuan\n';
      items.forEach(item => {
        csv += `"${item.name}",${item.price},"${item.category}","${item.unit}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `data-barang-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Data berhasil diexport!');
    }

    // ========== UI FUNCTIONS ==========
    function formatCurrency(amount) {
      return 'Rp ' + amount.toLocaleString('id-ID');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toastMessage').textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function switchUserTab(tabName) {
      currentUserTab = tabName;
      document.querySelectorAll('.user-tab-content').forEach(el => el.classList.add('hidden'));
      document.getElementById('tab-' + tabName).classList.remove('hidden');
      
      document.querySelectorAll('.user-nav-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-white/20');
        btn.classList.add('bg-white/10');
      });
      document.querySelector(`.user-nav-btn[data-tab="${tabName}"]`).classList.add('active', 'bg-white/20');
      document.querySelector(`.user-nav-btn[data-tab="${tabName}"]`).classList.remove('bg-white/10');
    }

    function switchAdminTab(tabName) {
      currentAdminTab = tabName;
      document.querySelectorAll('.admin-tab-content').forEach(el => el.classList.add('hidden'));
      document.getElementById('admin-' + tabName).classList.remove('hidden');
      
      document.querySelectorAll('.admin-nav-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-white/10');
      });
      document.querySelector(`.admin-nav-btn[data-tab="${tabName}"]`).classList.add('active', 'bg-white/10');
      
      const titles = {
        dashboard: 'Dashboard',
        dataBarang: 'Data Barang',
        kategori: 'Kategori',
        paket: 'Paket Belanja',
        laporan: 'Laporan'
      };
      document.getElementById('adminPageTitle').textContent = titles[tabName] || 'Dashboard';
    }

    // ========== EVENT LISTENERS ==========
    function initEventListeners() {
      // Login
      document.getElementById('adminLoginBtn').addEventListener('click', () => {
        document.getElementById('loginModal').classList.remove('hidden');
      });
      
      document.getElementById('closeLogin').addEventListener('click', () => {
        document.getElementById('loginModal').classList.add('hidden');
      });
      
      document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('adminName').value;
        const nip = document.getElementById('adminNip').value;
        
        if (name === 'Duta Hilmy Pratama' && nip === '101032530012') {
          isAdmin = true;
          document.getElementById('loginModal').classList.add('hidden');
          document.getElementById('userView').classList.add('hidden');
          document.getElementById('adminView').classList.remove('hidden');
          showToast('Login berhasil!');
        } else {
          document.getElementById('loginError').classList.remove('hidden');
        }
      });
      
      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        isAdmin = false;
        document.getElementById('adminView').classList.add('hidden');
        document.getElementById('userView').classList.remove('hidden');
        showToast('Logout berhasil!');
      });
      
      // Sidebar
      document.getElementById('toggleSidebar').addEventListener('click', () => {
        document.getElementById('adminSidebar').classList.toggle('-translate-x-full');
        document.getElementById('sidebarOverlay').classList.toggle('hidden');
      });
      
      document.getElementById('sidebarOverlay').addEventListener('click', () => {
        document.getElementById('adminSidebar').classList.add('-translate-x-full');
        document.getElementById('sidebarOverlay').classList.add('hidden');
      });
      
      // User Navigation
      document.querySelectorAll('.user-nav-btn').forEach(btn => {
        btn.addEventListener('click', () => switchUserTab(btn.dataset.tab));
      });
      
      // Admin Navigation
      document.querySelectorAll('.admin-nav-btn').forEach(btn => {
        btn.addEventListener('click', () => switchAdminTab(btn.dataset.tab));
      });
      
      // Add Item Form
      document.getElementById('addItemForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('itemName').value;
        const price = document.getElementById('itemPrice').value;
        const category = document.getElementById('itemCategory').value;
        const unit = document.getElementById('itemUnit').value;
        
        await addItem(name, price, category, unit);
        e.target.reset();
      });
      
      // Create Package Form
      document.getElementById('createPackageForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('packageName').value;
        const budget = document.getElementById('packageBudget').value;
        
        await createPackage(name, budget);
        e.target.reset();
      });
      
      // Search & Filter
      document.getElementById('searchItems').addEventListener('input', renderItemsList);
      document.getElementById('filterCategory').addEventListener('change', renderItemsList);
      
      // Budget
      document.getElementById('budgetInput').addEventListener('input', renderUserStats);
      
      // Cart Actions
      document.getElementById('clearCartBtn').addEventListener('click', clearCart);
      document.getElementById('checkoutBtn').addEventListener('click', () => {
        showToast('Belanja selesai! Cek rekap Anda.');
        switchUserTab('rekap');
      });
      
      // Export
      document.getElementById('downloadPdfBtn').addEventListener('click', generatePDF);
      document.getElementById('shareWaBtn').addEventListener('click', shareWhatsApp);
      document.getElementById('exportExcelBtn').addEventListener('click', exportCSV);
      document.getElementById('exportPdfAdminBtn').addEventListener('click', generatePDF);
    }

    // ========== INITIALIZE ==========
    async function init() {
      initElementSdk();
      await initDataSdk();
      initEventListeners();
      
      // Mobile sidebar default hidden
      if (window.innerWidth < 1024) {
        document.getElementById('adminSidebar').classList.add('-translate-x-full');
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c8a2e63e197fdab',t:'MTc3MDIwODI0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
