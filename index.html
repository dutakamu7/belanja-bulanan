<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Belanja Bulanan Pintar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    * {
      scrollbar-width: thin;
      scrollbar-color: #10b981 #e5e7eb;
    }
    
    .sidebar-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover {
      transition: all 0.2s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #047857 0%, #059669 100%);
      transform: translateY(-1px);
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
      transition: width 0.5s ease;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in {
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }
    
    .toast {
      animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards;
    }
    
    @keyframes toastIn {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes toastOut {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(100%); opacity: 0; }
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    .checkbox-custom:checked {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-slate-50 via-emerald-50/30 to-cyan-50/30">
  <div id="app" class="h-full overflow-auto"><!-- Toast Container -->
   <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div><!-- Login Modal -->
   <div id="login-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 fade-in">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
       </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-800">Login Admin</h2>
      <p class="text-gray-500 mt-2">Masuk ke dashboard admin</p>
     </div>
     <form id="login-form" class="space-y-4">
      <div><label for="admin-name" class="block text-sm font-medium text-gray-700 mb-2">Nama Admin</label> <input type="text" id="admin-name" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition" placeholder="Masukkan nama">
      </div>
      <div><label for="admin-nip" class="block text-sm font-medium text-gray-700 mb-2">NIP</label> <input type="text" id="admin-nip" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition" placeholder="Masukkan NIP">
      </div>
      <div id="login-error" class="text-red-500 text-sm hidden">
       Nama atau NIP salah!
      </div><button type="submit" class="w-full btn-primary text-white font-semibold py-3 rounded-xl"> Masuk </button>
     </form><button id="close-login" class="mt-4 w-full text-gray-500 hover:text-gray-700 font-medium py-2"> Kembali </button>
    </div>
   </div><!-- Add Item Modal -->
   <div id="add-item-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 fade-in max-h-[90%] overflow-auto">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-gray-800" id="modal-title">Tambah Barang Baru</h3><button id="close-add-modal" class="p-2 hover:bg-gray-100 rounded-full transition">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="add-item-form" class="space-y-4"><input type="hidden" id="edit-item-id" value="">
      <div><label for="item-name" class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label> <input type="text" id="item-name" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition" placeholder="Contoh: Beras 5kg">
      </div>
      <div class="grid grid-cols-2 gap-4">
       <div><label for="item-price" class="block text-sm font-medium text-gray-700 mb-2">Harga (Rp)</label> <input type="number" id="item-price" required min="0" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition" placeholder="50000">
       </div>
       <div><label for="item-unit" class="block text-sm font-medium text-gray-700 mb-2">Satuan</label> <select id="item-unit" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition bg-white"> <option value="pcs">Pcs</option> <option value="kg">Kg</option> <option value="liter">Liter</option> <option value="pack">Pack</option> <option value="dus">Dus</option> <option value="botol">Botol</option> <option value="sachet">Sachet</option> </select>
       </div>
      </div>
      <div><label for="item-category" class="block text-sm font-medium text-gray-700 mb-2">Kategori</label> <select id="item-category" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition bg-white"> <option value="Sembako">Sembako</option> <option value="Makanan Instan">Makanan Instan</option> <option value="Minuman">Minuman</option> <option value="Alat Mandi">Alat Mandi</option> <option value="Alat Kebersihan">Alat Kebersihan</option> <option value="Alat Sekolah">Alat Sekolah</option> <option value="Kebutuhan Kost">Kebutuhan Kost</option> <option value="Lainnya">Lainnya</option> </select>
      </div><button type="submit" class="w-full btn-primary text-white font-semibold py-3 rounded-xl mt-6"> <span id="submit-btn-text">Tambah Barang</span> </button>
     </form>
    </div>
   </div><!-- Delete Confirmation Modal -->
   <div id="delete-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 fade-in text-center">
     <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
     </div>
     <h3 class="text-lg font-bold text-gray-800 mb-2">Hapus Barang?</h3>
     <p class="text-gray-500 mb-6" id="delete-item-name">Barang ini akan dihapus permanen</p>
     <div class="flex gap-3"><button id="cancel-delete" class="flex-1 py-3 border border-gray-200 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition"> Batal </button> <button id="confirm-delete" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition"> Hapus </button>
     </div>
    </div>
   </div><!-- Main Layout -->
   <div class="flex h-full"><!-- Sidebar (Admin) -->
    <aside id="admin-sidebar" class="fixed lg:relative h-full bg-white shadow-xl z-40 sidebar-transition -translate-x-full lg:translate-x-0 hidden" style="width: 280px;">
     <div class="flex flex-col h-full"><!-- Sidebar Header -->
      <div class="p-6 border-b border-gray-100">
       <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
         </svg>
        </div>
        <div>
         <h1 class="font-bold text-gray-800">Admin Panel</h1>
         <p class="text-xs text-gray-500">Duta Hilmy Pratama</p>
        </div>
       </div>
      </div><!-- Sidebar Navigation -->
      <nav class="flex-1 p-4 space-y-1 overflow-auto"><button onclick="setAdminTab('dashboard')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="dashboard">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
        </svg><span>Dashboard</span> </button> <button onclick="setAdminTab('products')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="products">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
        </svg><span>Data Barang</span> </button> <button onclick="setAdminTab('categories')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="categories">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
        </svg><span>Kategori Barang</span> </button> <button onclick="setAdminTab('packages')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="packages">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg><span>Paket Belanja</span> </button> <button onclick="setAdminTab('reports')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="reports">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg><span>Laporan</span> </button> <button onclick="setAdminTab('settings')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition hover:bg-emerald-50" data-tab="settings">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg><span>Pengaturan</span> </button>
      </nav><!-- Sidebar Footer -->
      <div class="p-4 border-t border-gray-100"><button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-500 hover:bg-red-50 transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg><span>Logout</span> </button>
      </div>
     </div>
    </aside><!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden" onclick="toggleSidebar()"></div><!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0"><!-- Header -->
     <header class="bg-white/80 backdrop-blur-lg border-b border-gray-100 sticky top-0 z-20">
      <div class="flex items-center justify-between px-4 lg:px-8 py-4">
       <div class="flex items-center gap-4"><button id="menu-btn" class="lg:hidden p-2 hover:bg-gray-100 rounded-xl transition hidden">
         <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
         </svg></button>
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-xl flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
         </div>
         <div>
          <h1 id="header-title" class="font-bold text-gray-800 text-lg">Belanja Bulanan Pintar</h1>
          <p id="header-tagline" class="text-xs text-gray-500">Kelola Belanja Hemat &amp; Cerdas</p>
         </div>
        </div>
       </div>
       <div class="flex items-center gap-2"><button id="admin-login-btn" onclick="showLoginModal()" class="flex items-center gap-2 px-4 py-2 bg-emerald-50 text-emerald-600 rounded-xl hover:bg-emerald-100 transition font-medium text-sm">
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
         </svg><span class="hidden sm:inline">Admin</span> </button>
       </div>
      </div><!-- User Navigation -->
      <nav id="user-nav" class="px-4 lg:px-8 pb-4 flex gap-2 overflow-x-auto"><button onclick="setUserTab('home')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="home"> üè† Beranda </button> <button onclick="setUserTab('products')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="products"> üì¶ Daftar Barang </button> <button onclick="setUserTab('categories')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="categories"> üè∑Ô∏è Kategori </button> <button onclick="setUserTab('shopping')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="shopping"> üõí Belanja Bulanan </button> <button onclick="setUserTab('recap')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="recap"> üìä Rekap </button> <button onclick="setUserTab('tips')" class="user-nav-btn px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition" data-tab="tips"> üí° Tips Hemat </button>
      </nav>
     </header><!-- Content Area -->
     <div id="content-area" class="flex-1 p-4 lg:p-8 overflow-auto"><!-- Content will be rendered here -->
     </div>
    </main>
   </div>
  </div>
  <script>
    // Default Configuration
    const defaultConfig = {
      site_title: 'Belanja Bulanan Pintar',
      tagline: 'Kelola Belanja Hemat & Cerdas',
      primary_color: '#059669',
      secondary_color: '#0891b2',
      background_color: '#f8fafc',
      text_color: '#1e293b',
      accent_color: '#10b981'
    };

    // State
    let config = { ...defaultConfig };
    let isAdmin = false;
    let currentUserTab = 'home';
    let currentAdminTab = 'dashboard';
    let allItems = [];
    let shoppingCart = [];
    let monthlyBudget = 1500000;
    let deleteTargetId = null;

    const categories = [
      { name: 'Sembako', icon: 'üçö', color: 'bg-amber-100 text-amber-600' },
      { name: 'Makanan Instan', icon: 'üçú', color: 'bg-orange-100 text-orange-600' },
      { name: 'Minuman', icon: 'ü•§', color: 'bg-blue-100 text-blue-600' },
      { name: 'Alat Mandi', icon: 'üß¥', color: 'bg-pink-100 text-pink-600' },
      { name: 'Alat Kebersihan', icon: 'üßπ', color: 'bg-green-100 text-green-600' },
      { name: 'Alat Sekolah', icon: 'üìö', color: 'bg-purple-100 text-purple-600' },
      { name: 'Kebutuhan Kost', icon: 'üè†', color: 'bg-cyan-100 text-cyan-600' },
      { name: 'Lainnya', icon: 'üì¶', color: 'bg-gray-100 text-gray-600' }
    ];

    // Toast notification
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
      toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg font-medium`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Format currency
    function formatRupiah(num) {
      return 'Rp ' + num.toLocaleString('id-ID');
    }

    // Login functions
    function showLoginModal() {
      document.getElementById('login-modal').classList.remove('hidden');
    }

    function hideLoginModal() {
      document.getElementById('login-modal').classList.add('hidden');
      document.getElementById('login-error').classList.add('hidden');
    }

    document.getElementById('close-login').addEventListener('click', hideLoginModal);

    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('admin-name').value;
      const nip = document.getElementById('admin-nip').value;
      
      if (name === 'Duta Hilmy Pratama' && nip === '101032530012') {
        isAdmin = true;
        hideLoginModal();
        document.getElementById('admin-sidebar').classList.remove('hidden');
        document.getElementById('admin-sidebar').classList.remove('-translate-x-full');
        document.getElementById('user-nav').classList.add('hidden');
        document.getElementById('menu-btn').classList.remove('hidden');
        document.getElementById('admin-login-btn').classList.add('hidden');
        setAdminTab('dashboard');
        showToast('Selamat datang, Admin!');
      } else {
        document.getElementById('login-error').classList.remove('hidden');
      }
    });

    function logout() {
      isAdmin = false;
      document.getElementById('admin-sidebar').classList.add('hidden');
      document.getElementById('admin-sidebar').classList.add('-translate-x-full');
      document.getElementById('user-nav').classList.remove('hidden');
      document.getElementById('menu-btn').classList.add('hidden');
      document.getElementById('admin-login-btn').classList.remove('hidden');
      setUserTab('home');
      showToast('Berhasil logout');
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('admin-sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    }

    document.getElementById('menu-btn').addEventListener('click', toggleSidebar);

    // Navigation
    function setUserTab(tab) {
      currentUserTab = tab;
      document.querySelectorAll('.user-nav-btn').forEach(btn => {
        btn.classList.remove('bg-emerald-500', 'text-white');
        btn.classList.add('bg-gray-100', 'text-gray-600');
        if (btn.dataset.tab === tab) {
          btn.classList.add('bg-emerald-500', 'text-white');
          btn.classList.remove('bg-gray-100', 'text-gray-600');
        }
      });
      renderContent();
    }

    function setAdminTab(tab) {
      currentAdminTab = tab;
      document.querySelectorAll('.admin-nav-btn').forEach(btn => {
        btn.classList.remove('bg-emerald-100', 'text-emerald-600');
        btn.classList.add('text-gray-600');
        if (btn.dataset.tab === tab) {
          btn.classList.add('bg-emerald-100', 'text-emerald-600');
          btn.classList.remove('text-gray-600');
        }
      });
      renderContent();
    }

    // Add/Edit Item Modal
    function showAddItemModal(item = null) {
      const modal = document.getElementById('add-item-modal');
      const title = document.getElementById('modal-title');
      const btnText = document.getElementById('submit-btn-text');
      const editId = document.getElementById('edit-item-id');
      
      if (item) {
        title.textContent = 'Edit Barang';
        btnText.textContent = 'Simpan Perubahan';
        editId.value = item.__backendId;
        document.getElementById('item-name').value = item.name;
        document.getElementById('item-price').value = item.price;
        document.getElementById('item-unit').value = item.unit;
        document.getElementById('item-category').value = item.category;
      } else {
        title.textContent = 'Tambah Barang Baru';
        btnText.textContent = 'Tambah Barang';
        editId.value = '';
        document.getElementById('add-item-form').reset();
      }
      
      modal.classList.remove('hidden');
    }

    function hideAddItemModal() {
      document.getElementById('add-item-modal').classList.add('hidden');
    }

    document.getElementById('close-add-modal').addEventListener('click', hideAddItemModal);

    document.getElementById('add-item-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const editId = document.getElementById('edit-item-id').value;
      const name = document.getElementById('item-name').value;
      const price = parseInt(document.getElementById('item-price').value);
      const unit = document.getElementById('item-unit').value;
      const category = document.getElementById('item-category').value;
      
      if (editId) {
        // Update existing item
        const item = allItems.find(i => i.__backendId === editId);
        if (item) {
          const result = await window.dataSdk.update({
            ...item,
            name,
            price,
            unit,
            category
          });
          if (result.isOk) {
            showToast('Barang berhasil diperbarui');
          } else {
            showToast('Gagal memperbarui barang', 'error');
          }
        }
      } else {
        // Create new item
        if (allItems.filter(i => i.type === 'product').length >= 999) {
          showToast('Batas maksimal 999 barang tercapai', 'error');
          return;
        }
        
        const result = await window.dataSdk.create({
          type: 'product',
          name,
          price,
          unit,
          category,
          quantity: 0,
          isChecked: false,
          createdAt: new Date().toISOString()
        });
        
        if (result.isOk) {
          showToast('Barang berhasil ditambahkan');
        } else {
          showToast('Gagal menambahkan barang', 'error');
        }
      }
      
      hideAddItemModal();
    });

    // Delete Item
    function showDeleteModal(id, name) {
      deleteTargetId = id;
      document.getElementById('delete-item-name').textContent = `"${name}" akan dihapus permanen`;
      document.getElementById('delete-modal').classList.remove('hidden');
    }

    function hideDeleteModal() {
      document.getElementById('delete-modal').classList.add('hidden');
      deleteTargetId = null;
    }

    document.getElementById('cancel-delete').addEventListener('click', hideDeleteModal);

    document.getElementById('confirm-delete').addEventListener('click', async function() {
      if (deleteTargetId) {
        const item = allItems.find(i => i.__backendId === deleteTargetId);
        if (item) {
          const result = await window.dataSdk.delete(item);
          if (result.isOk) {
            showToast('Barang berhasil dihapus');
          } else {
            showToast('Gagal menghapus barang', 'error');
          }
        }
      }
      hideDeleteModal();
    });

    // Shopping Cart functions
    async function addToCart(item) {
      const cartItem = allItems.find(i => i.type === 'cart' && i.name === item.name);
      
      if (cartItem) {
        const result = await window.dataSdk.update({
          ...cartItem,
          quantity: cartItem.quantity + 1
        });
        if (result.isOk) {
          showToast(`${item.name} ditambahkan ke keranjang`);
        }
      } else {
        const result = await window.dataSdk.create({
          type: 'cart',
          name: item.name,
          price: item.price,
          unit: item.unit,
          category: item.category,
          quantity: 1,
          isChecked: false,
          createdAt: new Date().toISOString()
        });
        if (result.isOk) {
          showToast(`${item.name} ditambahkan ke keranjang`);
        }
      }
    }

    async function updateCartQuantity(item, newQty) {
      if (newQty <= 0) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
          showToast('Item dihapus dari keranjang');
        }
      } else {
        const result = await window.dataSdk.update({
          ...item,
          quantity: newQty
        });
      }
    }

    async function toggleCartCheck(item) {
      const result = await window.dataSdk.update({
        ...item,
        isChecked: !item.isChecked
      });
    }

    // Get products and cart items
    function getProducts() {
      return allItems.filter(i => i.type === 'product');
    }

    function getCartItems() {
      return allItems.filter(i => i.type === 'cart');
    }

    // Calculate totals
    function getCartTotal() {
      return getCartItems().reduce((sum, item) => sum + (item.price * item.quantity), 0);
    }

    function getCategoryTotals() {
      const cartItems = getCartItems();
      const totals = {};
      cartItems.forEach(item => {
        if (!totals[item.category]) totals[item.category] = 0;
        totals[item.category] += item.price * item.quantity;
      });
      return totals;
    }

    // Generate PDF
    function generatePDF() {
      const cartItems = getCartItems();
      const total = getCartTotal();
      const date = new Date().toLocaleDateString('id-ID', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      let content = `
        <html>
        <head>
          <title>Rekap Belanja Bulanan</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; }
            h1 { color: #059669; margin-bottom: 5px; }
            .date { color: #666; margin-bottom: 30px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
            th { background: #059669; color: white; }
            tr:nth-child(even) { background: #f9f9f9; }
            .total { font-size: 24px; color: #059669; margin-top: 30px; }
            .footer { margin-top: 40px; color: #666; font-size: 12px; }
          </style>
        </head>
        <body>
          <h1>üìã Rekap Belanja Bulanan</h1>
          <p class="date">${date}</p>
          <table>
            <thead>
              <tr>
                <th>No</th>
                <th>Nama Barang</th>
                <th>Kategori</th>
                <th>Harga</th>
                <th>Qty</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              ${cartItems.map((item, idx) => `
                <tr>
                  <td>${idx + 1}</td>
                  <td>${item.name}</td>
                  <td>${item.category}</td>
                  <td>${formatRupiah(item.price)}</td>
                  <td>${item.quantity} ${item.unit}</td>
                  <td>${formatRupiah(item.price * item.quantity)}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          <p class="total"><strong>Total: ${formatRupiah(total)}</strong></p>
          <p class="footer">Dibuat dengan Belanja Bulanan Pintar - ${new Date().toLocaleString('id-ID')}</p>
        </body>
        </html>
      `;

      const printWindow = window.open('', '_blank');
      printWindow.document.write(content);
      printWindow.document.close();
      printWindow.print();
    }

    // Share to WhatsApp
    function shareToWhatsApp() {
      const cartItems = getCartItems();
      const total = getCartTotal();
      const date = new Date().toLocaleDateString('id-ID');

      let message = `üìã *Rekap Belanja Bulanan*\nüìÖ ${date}\n\n`;
      
      cartItems.forEach((item, idx) => {
        message += `${idx + 1}. ${item.name}\n`;
        message += `   ${item.quantity} ${item.unit} x ${formatRupiah(item.price)} = ${formatRupiah(item.price * item.quantity)}\n\n`;
      });

      message += `üí∞ *Total: ${formatRupiah(total)}*\n\n`;
      message += `_Dibuat dengan Belanja Bulanan Pintar_`;

      const encodedMessage = encodeURIComponent(message);
      window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
    }

    // Render Content
    function renderContent() {
      const container = document.getElementById('content-area');
      
      if (isAdmin) {
        renderAdminContent(container);
      } else {
        renderUserContent(container);
      }
    }

    function renderUserContent(container) {
      const products = getProducts();
      const cartItems = getCartItems();
      const cartTotal = getCartTotal();
      const categoryTotals = getCategoryTotals();
      const budgetUsed = (cartTotal / monthlyBudget) * 100;

      switch(currentUserTab) {
        case 'home':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <!-- Hero Section -->
              <div class="bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-3xl p-6 lg:p-10 text-white">
                <h2 class="text-2xl lg:text-3xl font-bold mb-2">Selamat Datang! üëã</h2>
                <p class="text-emerald-100 mb-6">Kelola belanja bulananmu dengan cerdas dan hemat</p>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                  <div class="bg-white/20 backdrop-blur rounded-2xl p-4">
                    <p class="text-emerald-100 text-sm">Total Barang</p>
                    <p class="text-2xl font-bold">${products.length}</p>
                  </div>
                  <div class="bg-white/20 backdrop-blur rounded-2xl p-4">
                    <p class="text-emerald-100 text-sm">Di Keranjang</p>
                    <p class="text-2xl font-bold">${cartItems.length}</p>
                  </div>
                  <div class="bg-white/20 backdrop-blur rounded-2xl p-4">
                    <p class="text-emerald-100 text-sm">Total Belanja</p>
                    <p class="text-2xl font-bold">${formatRupiah(cartTotal)}</p>
                  </div>
                  <div class="bg-white/20 backdrop-blur rounded-2xl p-4">
                    <p class="text-emerald-100 text-sm">Sisa Anggaran</p>
                    <p class="text-2xl font-bold">${formatRupiah(Math.max(0, monthlyBudget - cartTotal))}</p>
                  </div>
                </div>
              </div>

              <!-- Budget Progress -->
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-bold text-gray-800">Anggaran Bulanan</h3>
                  <span class="text-sm text-gray-500">${formatRupiah(cartTotal)} / ${formatRupiah(monthlyBudget)}</span>
                </div>
                <div class="w-full h-4 bg-gray-100 rounded-full overflow-hidden">
                  <div class="progress-bar h-full rounded-full" style="width: ${Math.min(100, budgetUsed)}%"></div>
                </div>
                <p class="text-sm text-gray-500 mt-2">${budgetUsed.toFixed(1)}% dari anggaran terpakai</p>
              </div>

              <!-- Quick Categories -->
              <div>
                <h3 class="font-bold text-gray-800 mb-4">Kategori Cepat</h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                  ${categories.slice(0, 8).map(cat => `
                    <button onclick="setUserTab('categories'); setTimeout(() => filterByCategory('${cat.name}'), 100)" class="card-hover bg-white rounded-2xl p-4 text-center shadow-sm">
                      <span class="text-3xl">${cat.icon}</span>
                      <p class="text-sm font-medium text-gray-700 mt-2">${cat.name}</p>
                    </button>
                  `).join('')}
                </div>
              </div>

              <!-- Recent Products -->
              ${products.length > 0 ? `
                <div>
                  <h3 class="font-bold text-gray-800 mb-4">Barang Terbaru</h3>
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${products.slice(-6).reverse().map(item => `
                      <div class="card-hover bg-white rounded-2xl p-4 shadow-sm">
                        <div class="flex items-start justify-between">
                          <div class="flex-1">
                            <span class="text-xs px-2 py-1 ${categories.find(c => c.name === item.category)?.color || 'bg-gray-100 text-gray-600'} rounded-full">${item.category}</span>
                            <h4 class="font-semibold text-gray-800 mt-2">${item.name}</h4>
                            <p class="text-emerald-600 font-bold">${formatRupiah(item.price)}/${item.unit}</p>
                          </div>
                          <button onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center hover:bg-emerald-200 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                </div>
              ` : `
                <div class="bg-white rounded-2xl p-10 text-center shadow-sm">
                  <span class="text-6xl">üì¶</span>
                  <h3 class="text-xl font-bold text-gray-800 mt-4">Belum Ada Barang</h3>
                  <p class="text-gray-500 mt-2">Admin belum menambahkan data barang</p>
                </div>
              `}
            </div>
          `;
          break;

        case 'products':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800">Daftar Barang</h2>
                <span class="text-sm text-gray-500">${products.length} barang tersedia</span>
              </div>

              <!-- Search -->
              <div class="relative">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="search-products" onkeyup="searchProducts()" placeholder="Cari barang..." class="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none">
              </div>

              <!-- Products Grid -->
              <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                ${products.length > 0 ? products.map(item => `
                  <div class="card-hover bg-white rounded-2xl p-4 shadow-sm product-card" data-name="${item.name.toLowerCase()}">
                    <span class="text-xs px-2 py-1 ${categories.find(c => c.name === item.category)?.color || 'bg-gray-100 text-gray-600'} rounded-full">${item.category}</span>
                    <h4 class="font-semibold text-gray-800 mt-3 text-lg">${item.name}</h4>
                    <p class="text-emerald-600 font-bold text-xl mt-1">${formatRupiah(item.price)}<span class="text-sm font-normal text-gray-500">/${item.unit}</span></p>
                    <button onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="w-full mt-4 btn-primary text-white font-medium py-2 rounded-xl flex items-center justify-center gap-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                      </svg>
                      Tambah ke Keranjang
                    </button>
                  </div>
                `).join('') : `
                  <div class="col-span-full bg-white rounded-2xl p-10 text-center shadow-sm">
                    <span class="text-6xl">üì¶</span>
                    <h3 class="text-xl font-bold text-gray-800 mt-4">Belum Ada Barang</h3>
                    <p class="text-gray-500 mt-2">Admin belum menambahkan data barang</p>
                  </div>
                `}
              </div>
            </div>
          `;
          break;

        case 'categories':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Kategori Barang</h2>
              
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                ${categories.map(cat => {
                  const count = products.filter(p => p.category === cat.name).length;
                  return `
                    <button onclick="filterByCategory('${cat.name}')" class="card-hover bg-white rounded-2xl p-6 text-center shadow-sm">
                      <span class="text-4xl">${cat.icon}</span>
                      <p class="font-semibold text-gray-800 mt-3">${cat.name}</p>
                      <p class="text-sm text-gray-500">${count} barang</p>
                    </button>
                  `;
                }).join('')}
              </div>

              <div id="category-products" class="space-y-4"></div>
            </div>
          `;
          break;

        case 'shopping':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800">üõí Keranjang Belanja</h2>
                <span class="px-3 py-1 bg-emerald-100 text-emerald-600 rounded-full text-sm font-medium">${cartItems.length} item</span>
              </div>

              <!-- Budget Input -->
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-2">Anggaran Bulanan</label>
                <div class="relative">
                  <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">Rp</span>
                  <input type="number" id="budget-input" value="${monthlyBudget}" onchange="updateBudget(this.value)" class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none">
                </div>
                <div class="mt-4">
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-600">Terpakai</span>
                    <span class="font-medium">${formatRupiah(cartTotal)} (${budgetUsed.toFixed(1)}%)</span>
                  </div>
                  <div class="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                    <div class="progress-bar h-full rounded-full ${budgetUsed > 100 ? 'bg-red-500' : ''}" style="width: ${Math.min(100, budgetUsed)}%"></div>
                  </div>
                  <p class="text-sm mt-2 ${cartTotal > monthlyBudget ? 'text-red-500' : 'text-emerald-600'} font-medium">
                    ${cartTotal > monthlyBudget ? '‚ö†Ô∏è Melebihi anggaran!' : `‚úì Sisa: ${formatRupiah(monthlyBudget - cartTotal)}`}
                  </p>
                </div>
              </div>

              <!-- Cart Items -->
              ${cartItems.length > 0 ? `
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                  <div class="divide-y divide-gray-100">
                    ${cartItems.map(item => `
                      <div class="p-4 flex items-center gap-4">
                        <input type="checkbox" ${item.isChecked ? 'checked' : ''} onchange="toggleCartCheck(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="w-5 h-5 rounded-lg border-gray-300 text-emerald-600 focus:ring-emerald-500 checkbox-custom">
                        <div class="flex-1 min-w-0">
                          <h4 class="font-medium text-gray-800 ${item.isChecked ? 'line-through text-gray-400' : ''}">${item.name}</h4>
                          <p class="text-sm text-gray-500">${item.category} ‚Ä¢ ${formatRupiah(item.price)}/${item.unit}</p>
                        </div>
                        <div class="flex items-center gap-2">
                          <button onclick="updateCartQuantity(${JSON.stringify(item).replace(/"/g, '&quot;')}, ${item.quantity - 1})" class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
                          </button>
                          <span class="w-8 text-center font-medium">${item.quantity}</span>
                          <button onclick="updateCartQuantity(${JSON.stringify(item).replace(/"/g, '&quot;')}, ${item.quantity + 1})" class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                          </button>
                        </div>
                        <p class="font-bold text-emerald-600 w-24 text-right">${formatRupiah(item.price * item.quantity)}</p>
                      </div>
                    `).join('')}
                  </div>
                  <div class="p-4 bg-emerald-50 border-t border-emerald-100">
                    <div class="flex justify-between items-center">
                      <span class="font-bold text-gray-800">Total Belanja</span>
                      <span class="text-2xl font-bold text-emerald-600">${formatRupiah(cartTotal)}</span>
                    </div>
                  </div>
                </div>
              ` : `
                <div class="bg-white rounded-2xl p-10 text-center shadow-sm">
                  <span class="text-6xl">üõí</span>
                  <h3 class="text-xl font-bold text-gray-800 mt-4">Keranjang Kosong</h3>
                  <p class="text-gray-500 mt-2">Tambahkan barang dari daftar barang</p>
                  <button onclick="setUserTab('products')" class="mt-4 btn-primary text-white px-6 py-2 rounded-xl font-medium">
                    Lihat Daftar Barang
                  </button>
                </div>
              `}
            </div>
          `;
          break;

        case 'recap':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">üìä Rekap Belanja</h2>

              <!-- Summary Cards -->
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                  <p class="text-sm text-gray-500">Total Item</p>
                  <p class="text-2xl font-bold text-gray-800">${cartItems.length}</p>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                  <p class="text-sm text-gray-500">Total Qty</p>
                  <p class="text-2xl font-bold text-gray-800">${cartItems.reduce((sum, i) => sum + i.quantity, 0)}</p>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                  <p class="text-sm text-gray-500">Total Belanja</p>
                  <p class="text-2xl font-bold text-emerald-600">${formatRupiah(cartTotal)}</p>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                  <p class="text-sm text-gray-500">Sisa Anggaran</p>
                  <p class="text-2xl font-bold ${cartTotal > monthlyBudget ? 'text-red-500' : 'text-cyan-600'}">${formatRupiah(Math.max(0, monthlyBudget - cartTotal))}</p>
                </div>
              </div>

              <!-- Category Breakdown -->
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4">Belanja per Kategori</h3>
                <div class="space-y-3">
                  ${Object.entries(categoryTotals).map(([cat, total]) => {
                    const percentage = (total / cartTotal) * 100;
                    const catInfo = categories.find(c => c.name === cat);
                    return `
                      <div>
                        <div class="flex justify-between items-center mb-1">
                          <span class="text-sm font-medium text-gray-700">${catInfo?.icon || 'üì¶'} ${cat}</span>
                          <span class="text-sm font-bold text-gray-800">${formatRupiah(total)}</span>
                        </div>
                        <div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                          <div class="h-full bg-emerald-500 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                      </div>
                    `;
                  }).join('')}
                  ${Object.keys(categoryTotals).length === 0 ? '<p class="text-gray-500 text-center py-4">Belum ada data belanja</p>' : ''}
                </div>
              </div>

              <!-- Export Buttons -->
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button onclick="generatePDF()" class="btn-primary text-white font-semibold py-4 rounded-xl flex items-center justify-center gap-3" ${cartItems.length === 0 ? 'disabled style="opacity:0.5;cursor:not-allowed"' : ''}>
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                  Download PDF
                </button>
                <button onclick="shareToWhatsApp()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-4 rounded-xl flex items-center justify-center gap-3 transition" ${cartItems.length === 0 ? 'disabled style="opacity:0.5;cursor:not-allowed"' : ''}>
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                  </svg>
                  Kirim ke WhatsApp
                </button>
              </div>
            </div>
          `;
          break;

        case 'tips':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">üí° Tips Hemat Belanja</h2>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                ${[
                  { icon: 'üìù', title: 'Buat Daftar Belanja', desc: 'Selalu buat daftar sebelum belanja untuk menghindari pembelian impulsif yang tidak direncanakan.' },
                  { icon: 'üè∑Ô∏è', title: 'Bandingkan Harga', desc: 'Bandingkan harga di beberapa toko atau marketplace sebelum membeli barang.' },
                  { icon: 'üì¶', title: 'Beli Kemasan Besar', desc: 'Untuk barang yang sering dipakai, beli kemasan besar lebih hemat dalam jangka panjang.' },
                  { icon: 'üóìÔ∏è', title: 'Belanja di Akhir Bulan', desc: 'Banyak promo dan diskon di akhir bulan, manfaatkan untuk berhemat.' },
                  { icon: 'üç≥', title: 'Masak Sendiri', desc: 'Memasak sendiri jauh lebih hemat daripada beli makanan jadi atau pesan online.' },
                  { icon: 'üí∞', title: 'Sisihkan Sisa Anggaran', desc: 'Jika masih ada sisa anggaran, tabung untuk kebutuhan darurat.' },
                  { icon: 'üõí', title: 'Gunakan Promo', desc: 'Manfaatkan voucher, cashback, dan promo dari marketplace dan toko.' },
                  { icon: 'üìä', title: 'Evaluasi Pengeluaran', desc: 'Review pengeluaran setiap bulan untuk menemukan area yang bisa dihemat.' }
                ].map(tip => `
                  <div class="card-hover bg-white rounded-2xl p-6 shadow-sm">
                    <span class="text-3xl">${tip.icon}</span>
                    <h3 class="font-bold text-gray-800 mt-3">${tip.title}</h3>
                    <p class="text-gray-600 mt-2 text-sm leading-relaxed">${tip.desc}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          break;
      }
    }

    function renderAdminContent(container) {
      const products = getProducts();
      const cartItems = getCartItems();
      const cartTotal = getCartTotal();
      const categoryTotals = getCategoryTotals();

      switch(currentAdminTab) {
        case 'dashboard':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Dashboard Admin</h2>
              
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white">
                  <p class="text-emerald-100 text-sm">Total Barang</p>
                  <p class="text-3xl font-bold mt-2">${products.length}</p>
                </div>
                <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-6 text-white">
                  <p class="text-cyan-100 text-sm">Kategori Aktif</p>
                  <p class="text-3xl font-bold mt-2">${new Set(products.map(p => p.category)).size}</p>
                </div>
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white">
                  <p class="text-blue-100 text-sm">Total di Keranjang</p>
                  <p class="text-3xl font-bold mt-2">${cartItems.length}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 text-white">
                  <p class="text-purple-100 text-sm">Nilai Belanja</p>
                  <p class="text-xl font-bold mt-2">${formatRupiah(cartTotal)}</p>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4">Aksi Cepat</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                  <button onclick="showAddItemModal()" class="btn-primary text-white py-3 rounded-xl font-medium">
                    + Tambah Barang
                  </button>
                  <button onclick="setAdminTab('products')" class="bg-cyan-500 hover:bg-cyan-600 text-white py-3 rounded-xl font-medium transition">
                    Kelola Barang
                  </button>
                  <button onclick="setAdminTab('reports')" class="bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-medium transition">
                    Lihat Laporan
                  </button>
                  <button onclick="generatePDF()" class="bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-xl font-medium transition">
                    Export PDF
                  </button>
                </div>
              </div>

              <!-- Products by Category -->
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4">Barang per Kategori</h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                  ${categories.map(cat => {
                    const count = products.filter(p => p.category === cat.name).length;
                    return `
                      <div class="p-4 rounded-xl ${cat.color}">
                        <span class="text-2xl">${cat.icon}</span>
                        <p class="font-semibold mt-2">${cat.name}</p>
                        <p class="text-sm opacity-75">${count} barang</p>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            </div>
          `;
          break;

        case 'products':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <div class="flex items-center justify-between flex-wrap gap-4">
                <h2 class="text-xl font-bold text-gray-800">Data Barang</h2>
                <button onclick="showAddItemModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  Tambah Barang
                </button>
              </div>

              ${products.length > 0 ? `
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                  <div class="overflow-x-auto">
                    <table class="w-full">
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-600">Nama Barang</th>
                          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-600">Kategori</th>
                          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-600">Harga</th>
                          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-600">Satuan</th>
                          <th class="px-6 py-4 text-right text-sm font-semibold text-gray-600">Aksi</th>
                        </tr>
                      </thead>
                      <tbody class="divide-y divide-gray-100">
                        ${products.map(item => `
                          <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 font-medium text-gray-800">${item.name}</td>
                            <td class="px-6 py-4">
                              <span class="px-2 py-1 text-xs rounded-full ${categories.find(c => c.name === item.category)?.color || 'bg-gray-100 text-gray-600'}">${item.category}</span>
                            </td>
                            <td class="px-6 py-4 text-emerald-600 font-medium">${formatRupiah(item.price)}</td>
                            <td class="px-6 py-4 text-gray-600">${item.unit}</td>
                            <td class="px-6 py-4">
                              <div class="flex items-center justify-end gap-2">
                                <button onclick="showAddItemModal(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                  </svg>
                                </button>
                                <button onclick="showDeleteModal('${item.__backendId}', '${item.name}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                  </svg>
                                </button>
                              </div>
                            </td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  </div>
                </div>
              ` : `
                <div class="bg-white rounded-2xl p-10 text-center shadow-sm">
                  <span class="text-6xl">üì¶</span>
                  <h3 class="text-xl font-bold text-gray-800 mt-4">Belum Ada Barang</h3>
                  <p class="text-gray-500 mt-2">Klik tombol "Tambah Barang" untuk mulai</p>
                </div>
              `}
            </div>
          `;
          break;

        case 'categories':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Kategori Barang</h2>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                ${categories.map(cat => {
                  const count = products.filter(p => p.category === cat.name).length;
                  const items = products.filter(p => p.category === cat.name);
                  return `
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                      <div class="flex items-center gap-3 mb-4">
                        <span class="text-3xl">${cat.icon}</span>
                        <div>
                          <h3 class="font-bold text-gray-800">${cat.name}</h3>
                          <p class="text-sm text-gray-500">${count} barang</p>
                        </div>
                      </div>
                      ${items.length > 0 ? `
                        <div class="space-y-2 max-h-40 overflow-auto">
                          ${items.slice(0, 5).map(item => `
                            <div class="flex items-center justify-between text-sm">
                              <span class="text-gray-600 truncate">${item.name}</span>
                              <span class="text-emerald-600 font-medium">${formatRupiah(item.price)}</span>
                            </div>
                          `).join('')}
                          ${items.length > 5 ? `<p class="text-xs text-gray-400">+${items.length - 5} lainnya</p>` : ''}
                        </div>
                      ` : `
                        <p class="text-sm text-gray-400">Belum ada barang</p>
                      `}
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          `;
          break;

        case 'packages':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Paket Belanja Bulanan</h2>
              
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                ${[
                  { name: 'Paket Hemat', budget: 500000, color: 'from-green-500 to-emerald-500', items: ['Beras', 'Mie Instan', 'Telur', 'Minyak Goreng'] },
                  { name: 'Paket Standar', budget: 1000000, color: 'from-blue-500 to-cyan-500', items: ['Beras', 'Lauk Pauk', 'Sayuran', 'Sabun', 'Shampo'] },
                  { name: 'Paket Lengkap', budget: 1500000, color: 'from-purple-500 to-pink-500', items: ['Semua Kebutuhan', 'Snack', 'Minuman', 'Alat Tulis'] }
                ].map(pkg => `
                  <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <div class="bg-gradient-to-r ${pkg.color} p-6 text-white">
                      <h3 class="text-xl font-bold">${pkg.name}</h3>
                      <p class="text-2xl font-bold mt-2">${formatRupiah(pkg.budget)}</p>
                      <p class="text-sm opacity-75">per bulan</p>
                    </div>
                    <div class="p-6">
                      <p class="text-sm text-gray-500 mb-3">Termasuk:</p>
                      <ul class="space-y-2">
                        ${pkg.items.map(item => `
                          <li class="flex items-center gap-2 text-sm text-gray-600">
                            <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            ${item}
                          </li>
                        `).join('')}
                      </ul>
                      <button onclick="monthlyBudget = ${pkg.budget}; setUserTab('shopping'); logout();" class="w-full mt-4 btn-primary text-white py-2 rounded-xl font-medium">
                        Gunakan Paket
                      </button>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          break;

        case 'reports':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Laporan</h2>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-6 shadow-sm">
                  <h3 class="font-bold text-gray-800 mb-4">Statistik Barang</h3>
                  <div class="space-y-4">
                    ${categories.map(cat => {
                      const count = products.filter(p => p.category === cat.name).length;
                      const percentage = products.length > 0 ? (count / products.length) * 100 : 0;
                      return `
                        <div>
                          <div class="flex justify-between text-sm mb-1">
                            <span>${cat.icon} ${cat.name}</span>
                            <span class="font-medium">${count} (${percentage.toFixed(0)}%)</span>
                          </div>
                          <div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-emerald-500 rounded-full" style="width: ${percentage}%"></div>
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm">
                  <h3 class="font-bold text-gray-800 mb-4">Ringkasan</h3>
                  <div class="space-y-4">
                    <div class="flex justify-between p-3 bg-gray-50 rounded-xl">
                      <span class="text-gray-600">Total Barang</span>
                      <span class="font-bold">${products.length}</span>
                    </div>
                    <div class="flex justify-between p-3 bg-gray-50 rounded-xl">
                      <span class="text-gray-600">Total Kategori</span>
                      <span class="font-bold">${new Set(products.map(p => p.category)).size}</span>
                    </div>
                    <div class="flex justify-between p-3 bg-gray-50 rounded-xl">
                      <span class="text-gray-600">Item di Keranjang</span>
                      <span class="font-bold">${cartItems.length}</span>
                    </div>
                    <div class="flex justify-between p-3 bg-emerald-50 rounded-xl">
                      <span class="text-emerald-600">Total Nilai Belanja</span>
                      <span class="font-bold text-emerald-600">${formatRupiah(cartTotal)}</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex gap-4">
                <button onclick="generatePDF()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                  Export PDF
                </button>
                <button onclick="shareToWhatsApp()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-medium flex items-center gap-2 transition">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                  </svg>
                  Share WhatsApp
                </button>
              </div>
            </div>
          `;
          break;

        case 'settings':
          container.innerHTML = `
            <div class="fade-in space-y-6">
              <h2 class="text-xl font-bold text-gray-800">Pengaturan</h2>
              
              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4">Informasi Admin</h3>
                <div class="space-y-4">
                  <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
                    <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-cyan-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                      D
                    </div>
                    <div>
                      <h4 class="font-bold text-gray-800">Duta Hilmy Pratama</h4>
                      <p class="text-sm text-gray-500">NIP: 101032530012</p>
                      <p class="text-sm text-emerald-600">Administrator</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-2xl p-6 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4">Tentang Aplikasi</h3>
                <div class="space-y-3 text-sm text-gray-600">
                  <p><strong>Nama:</strong> Belanja Bulanan Pintar</p>
                  <p><strong>Versi:</strong> 1.0.0</p>
                  <p><strong>Deskripsi:</strong> Aplikasi pengelolaan belanja bulanan untuk mahasiswa dan anak rantau</p>
                  <p><strong>Fitur:</strong> Manajemen barang, kalkulasi otomatis, export PDF, share WhatsApp</p>
                </div>
              </div>

              <button onclick="logout()" class="w-full sm:w-auto bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-medium flex items-center justify-center gap-2 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
                Logout
              </button>
            </div>
          `;
          break;
      }
    }

    // Helper functions
    function searchProducts() {
      const query = document.getElementById('search-products').value.toLowerCase();
      document.querySelectorAll('.product-card').forEach(card => {
        const name = card.dataset.name;
        card.style.display = name.includes(query) ? '' : 'none';
      });
    }

    function filterByCategory(category) {
      const products = getProducts().filter(p => p.category === category);
      const catInfo = categories.find(c => c.name === category);
      
      const container = document.getElementById('category-products');
      if (container) {
        container.innerHTML = `
          <div class="flex items-center justify-between">
            <h3 class="font-bold text-gray-800">${catInfo?.icon || 'üì¶'} ${category}</h3>
            <span class="text-sm text-gray-500">${products.length} barang</span>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            ${products.length > 0 ? products.map(item => `
              <div class="card-hover bg-white rounded-2xl p-4 shadow-sm">
                <h4 class="font-semibold text-gray-800">${item.name}</h4>
                <p class="text-emerald-600 font-bold text-lg">${formatRupiah(item.price)}/${item.unit}</p>
                <button onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="w-full mt-3 btn-primary text-white py-2 rounded-xl font-medium">
                  + Tambah
                </button>
              </div>
            `).join('') : `
              <div class="col-span-full bg-gray-50 rounded-xl p-6 text-center">
                <p class="text-gray-500">Belum ada barang di kategori ini</p>
              </div>
            `}
          </div>
        `;
      }
    }

    function updateBudget(value) {
      monthlyBudget = parseInt(value) || 0;
      renderContent();
    }

    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        allItems = data;
        renderContent();
      }
    };

    // Element SDK initialization
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      document.getElementById('header-title').textContent = config.site_title || defaultConfig.site_title;
      document.getElementById('header-tagline').textContent = config.tagline || defaultConfig.tagline;
    }

    // Initialize
    async function init() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (cfg) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['site_title', cfg.site_title || defaultConfig.site_title],
            ['tagline', cfg.tagline || defaultConfig.tagline]
          ])
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }

      // Set initial tab
      setUserTab('home');
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c85d3e5c5d1919f',t:'MTc3MDE2MjU5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>